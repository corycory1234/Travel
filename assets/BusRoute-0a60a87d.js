import{_ as Y,r as o,E as ee,n as te,b as l,c as i,d as t,i as _,w as f,A as k,G as J,H as z,F as S,e as B,q as se,x as E,g as c,f as U,I as ae,h as m,J as oe,l as ne,p as le,j as ie,K as ce,L as ue,O as re,P as ve,t as F,a as I}from"./index-0f1266ca.js";const g=R=>(le("data-v-fca75fb9"),R=R(),ie(),R),de={class:"container"},pe={class:"navBar justify-content-center justify-content-md-between py-3"},_e=g(()=>t("div",{class:""},[t("img",{src:ce,alt:""})],-1)),me={class:"nav-links d-none d-md-flex mt-2"},he=g(()=>t("img",{src:ue,alt:"",class:"link-img"},null,-1)),fe=g(()=>t("img",{src:re,alt:"",class:"link-img"},null,-1)),ge=g(()=>t("img",{src:ve,alt:"",class:"link-img"},null,-1)),we={class:"nav justify-content-between shadow-sm d-md-none bg-white w-100 rounded my-1"},ke={class:"nav-item"},Se={class:"nav-item"},Te={class:"nav-item"},ye={class:"input-group mt-2"},De=g(()=>t("option",{value:""},"選擇縣市",-1)),xe=["value"],Be=g(()=>t("option",{value:""},"選擇路線",-1)),Re=["value"],be={class:"btn btn-md btnBgc rounded ms-1"},Ie=["onClick"],Ne={class:"container pt-4 g-0"},Ce=g(()=>t("h3",{class:"d-none d-lg-block"},"請先選擇縣市，再選擇公車路線",-1)),Ee=["onClick"],Ue={class:"pink"},Fe=["onClick"],$e={class:"pink"},Oe={class:"container"},Ze={class:"d-flex justify-content-end"},je={class:"pink"},He={key:0,class:"container py-5"},Ve={class:"col-8 col-md-2 ps-2"},Ae={class:"row align-items-center justify-content-md-center gx-0"},Je={class:"col-8 col-md-2 px-2"},ze={__name:"BusRoute",setup(R){const d=o(""),T=o(""),$=o([]),M=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}},a=`https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/${d.value}?%24format=JSON`;I.get(a,n).then(e=>{$.value=e.data})},O=o([]),Z=o([]),b=o(60),j=o([]),H=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}},a=`https://tdx.transportdata.tw/api/basic/v2/Bus/EstimatedTimeOfArrival/City/${d.value}/${T.value}?%24format=JSON`;I.get(a,n).then(r=>{const p=r.data,h=p.filter(v=>!v.Direction),X=p.filter(v=>v.Direction);h.forEach(v=>{O.value.push({StopUID:v.StopUID,EstimateTime:v.EstimateTime})}),X.forEach(v=>{Z.value.push({StopUID:v.StopUID,EstimateTime:v.EstimateTime})}),G()});const e=`https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/${d.value}/${T.value}?%24top=30&%24format=JSON`;I.get(e,n).then(r=>{j.value=r.data})},y=o([]),D=o([]),s=o(0),u=o(""),G=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}};y.value=[],D.value=[];const a=`https://tdx.transportdata.tw/api/basic/v2/Bus/DisplayStopOfRoute/City/${d.value}/${T.value}?%24format=JSON`;I.get(a,n).then(e=>{const r=e.data;r[0].Stops.forEach(p=>{O.value.forEach(h=>{p.StopUID===h.StopUID&&(s.value=Math.floor(h.EstimateTime/60),s.value===0?u.value="進站中":s.value<=1&&0<s.value?u.value="即將到站":s.value?u.value=`${s.value} 分鐘`:u.value="未發車")}),y.value.push({stops:p.StopName.Zh_tw,timeText:u.value,time:s.value})}),r[1].Stops.forEach(p=>{Z.value.forEach(h=>{p.StopUID===h.StopUID&&(s.value=Math.floor(h.EstimateTime/60),s.value===0?u.value="進站中":s.value<=1&&0<s.value?u.value="即將到站":s.value?u.value=`${s.value}分鐘`:u.value="未發車")}),D.value.push({stops:p.StopName.Zh_tw,timeText:u.value,time:s.value})})})},N=o(!0),C=o(!1),L=()=>{C.value=!1,N.value=!0},W=()=>{N.value=!1,C.value=!0};let V,A;const q=()=>{V=setInterval(()=>{b.value--,b.value===0&&(b.value=60)},1e3)},K=()=>{A=setInterval(()=>{H()},6e4)},P=()=>{clearInterval(V),clearInterval(A),q(),K()},Q=()=>{H(),P()},w=x=>ae().path===x;return ee(()=>d.value,()=>{d.value&&setTimeout(()=>{M()},1e3)}),(x,n)=>{const a=te("router-link");return l(),i(S,null,[t("div",de,[t("nav",pe,[_(a,{to:{name:"Home"}},{default:f(()=>[_e]),_:1}),t("div",me,[_(a,{to:"/view/Home.vue",class:"header-link spot text-nowrap",href:"#"},{default:f(()=>[he,m(" 台灣景點 ")]),_:1}),_(a,{to:"/view/FoodTravel.vue",class:"header-link food text-nowrap",href:"#"},{default:f(()=>[fe,m(" 美食住宿 ")]),_:1}),_(a,{to:{name:"BusRoute"},href:"#",class:"header-link traffic text-nowrap"},{default:f(()=>[ge,m(" 景點交通 ")]),_:1})])]),t("ul",we,[t("li",ke,[_(a,{to:"/view/Home.vue",class:k(["nav-link p-2",{activeTrue:w("/view/Home.vue"),activeFalse:!w("/view/Home.vue")}]),"aria-current":"page"},{default:f(()=>[m("景點活動 ")]),_:1},8,["class"])]),t("li",Se,[_(a,{to:"/view/FoodTravel.vue",class:k(["nav-link p-2",{activeTrue:w("/view/FoodTravel.vue"),activeFalse:!w("/view/FoodTravel.vue")}])},{default:f(()=>[m("美食住宿 ")]),_:1},8,["class"])]),t("li",Te,[_(a,{to:"/view/BusRoute/BusRoute.vue",class:k(["nav-link p-2",{activeTrue:w("/view/BusRoute/BusRoute.vue"),activeFalse:!w("/view/BusRoute/BusRoute.vue")}])},{default:f(()=>[m("景點交通 ")]),_:1},8,["class"])])]),t("div",ye,[J(t("select",{name:"",id:"",class:"form-select me-1 rounded border-0 shadow-sm","onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e)},[De,(l(!0),i(S,null,B(se(oe),(e,r)=>(l(),i("option",{value:e.Value,key:r},c(e.CityName),9,xe))),128))],512),[[z,d.value]]),J(t("select",{name:"",id:"",class:"form-select rounded border-0 shadow-sm","onUpdate:modelValue":n[1]||(n[1]=e=>T.value=e)},[Be,(l(!0),i(S,null,B($.value,e=>(l(),i("option",{value:e.RouteName.Zh_tw,key:e.RouteUID}," ["+c(e.RouteName.Zh_tw)+"] "+c(e.DepartureStopNameZh)+" - "+c(e.DestinationStopNameZh),9,Re))),128))],512),[[z,T.value]]),t("button",be,[t("span",null,[t("i",{class:"bi bi-search",onClick:E(Q,["prevent"])},null,8,Ie)])])]),t("div",Ne,[Ce,(l(!0),i(S,null,B(j.value,e=>(l(),i("ul",{class:"row row-cols-2 mx-1 rounded py-2 shadow-sm",key:e.RouteID},[t("li",{class:"col",onClick:E(L,["prevent"])},[m("往 "),t("span",Ue,c(e.DepartureStopNameZh),1)],8,Ee),t("li",{class:"col",onClick:E(W,["prevent"])},[m("往 "),t("span",$e,c(e.DestinationStopNameZh),1)],8,Fe)]))),128))])]),t("div",Oe,[t("div",Ze,[t("p",je," *每隔"+c(b.value)+"秒自動更新",1)])]),t("div",{class:k(["container",y.value.length>0||D.value.length>0?"height":"vhHeight"])},[y.value.length>0||D.value.length>0?(l(),i("div",He,[N.value?(l(!0),i(S,{key:0},B(y.value,(e,r)=>(l(),i("div",{key:r,class:"row align-items-center justify-content-md-center gx-0"},[t("p",{class:k(["col-4 col-md-2 rounded p-2 text-center",{arriving:e.time===0,coming:e.time<=1&&e.time>0,onTheWay:e.time>1,noDepart:!e.time}])},c(e.timeText),3),t("p",Ve,c(e.stops),1)]))),128)):U("",!0),C.value?(l(!0),i(S,{key:1},B(D.value,e=>(l(),i("div",Ae,[t("p",{class:k(["col-4 col-md-2 rounded p-2 text-center",{arriving:e.time===0,coming:e.time<=1&&e.time>0,onTheWay:e.time>1,noDepart:!e.time}])},c(e.timeText),3),t("p",Je,c(e.stops),1)]))),256)):U("",!0)])):U("",!0)],2),_(ne)],64)}}},Ge=Y(ze,[["__scopeId","data-v-fca75fb9"]]);export{Ge as default};
