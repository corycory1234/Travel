import{_ as Y,r as o,E as ee,n as te,b as l,c as i,d as t,i as d,w as f,A as k,H as J,I as z,F as S,e as B,q as se,x as E,g as c,f as U,J as ae,h as m,K as oe,G as ne,l as le,p as ie,j as ce,L as ue,O as re,P as ve,Q as de,t as F,a as N}from"./index-6f5c38ef.js";const g=R=>(ie("data-v-aad8019c"),R=R(),ce(),R),pe={class:"container"},_e={class:"navBar justify-content-center justify-content-md-between py-3"},me=g(()=>t("div",{class:""},[t("img",{src:ue,alt:""})],-1)),he={class:"nav-links d-none d-md-flex mt-2"},fe=g(()=>t("img",{src:re,alt:"",class:"link-img"},null,-1)),ge=g(()=>t("img",{src:ve,alt:"",class:"link-img"},null,-1)),we=g(()=>t("img",{src:de,alt:"",class:"link-img"},null,-1)),ke={class:"nav justify-content-between shadow-sm d-md-none bg-white w-100 rounded my-1"},Se={class:"nav-item"},Te={class:"nav-item"},De={class:"nav-item"},ye={class:"input-group mt-2"},xe=g(()=>t("option",{value:""},"選擇縣市",-1)),Be=["value"],Re=g(()=>t("option",{value:""},"選擇路線",-1)),Ie=["value"],Ne={class:"btn btn-md btnBgc rounded ms-1"},be=["onClick"],Ce={class:"container pt-4 g-0"},Ee=g(()=>t("h3",{class:"d-none d-lg-block"},"請先選擇縣市，再選擇公車路線",-1)),Ue=["onClick"],Fe={class:"pink"},$e=["onClick"],Oe={class:"pink"},Ze={class:"container"},je={class:"d-flex justify-content-end"},He={class:"pink"},Ve={key:0,class:"container"},Ae={class:"col-8 col-md-2 ps-2"},Je={class:"row align-items-center justify-content-md-center gx-0"},ze={class:"col-8 col-md-2 px-2"},Me={__name:"BusRoute",setup(R){const p=o(""),T=o(""),$=o([]),M=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}},a=`https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/${p.value}?%24format=JSON`;N.get(a,n).then(e=>{$.value=e.data})},O=o([]),Z=o([]),I=o(60),j=o([]),H=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}},a=`https://tdx.transportdata.tw/api/basic/v2/Bus/EstimatedTimeOfArrival/City/${p.value}/${T.value}?%24format=JSON`;N.get(a,n).then(r=>{const _=r.data,h=_.filter(v=>!v.Direction),X=_.filter(v=>v.Direction);h.forEach(v=>{O.value.push({StopUID:v.StopUID,EstimateTime:v.EstimateTime})}),X.forEach(v=>{Z.value.push({StopUID:v.StopUID,EstimateTime:v.EstimateTime})}),G()});const e=`https://tdx.transportdata.tw/api/basic/v2/Bus/Route/City/${p.value}/${T.value}?%24top=30&%24format=JSON`;N.get(e,n).then(r=>{j.value=r.data})},D=o([]),y=o([]),s=o(0),u=o(""),G=async()=>{const n={headers:{authorization:"Bearer "+await F.getToken()}};D.value=[],y.value=[];const a=`https://tdx.transportdata.tw/api/basic/v2/Bus/DisplayStopOfRoute/City/${p.value}/${T.value}?%24format=JSON`;N.get(a,n).then(e=>{const r=e.data;r[0].Stops.forEach(_=>{O.value.forEach(h=>{_.StopUID===h.StopUID&&(s.value=Math.floor(h.EstimateTime/60),s.value===0?u.value="進站中":s.value<=1&&0<s.value?u.value="即將到站":s.value?u.value=`${s.value} 分鐘`:u.value="未發車")}),D.value.push({stops:_.StopName.Zh_tw,timeText:u.value,time:s.value})}),r[1].Stops.forEach(_=>{Z.value.forEach(h=>{_.StopUID===h.StopUID&&(s.value=Math.floor(h.EstimateTime/60),s.value===0?u.value="進站中":s.value<=1&&0<s.value?u.value="即將到站":s.value?u.value=`${s.value}分鐘`:u.value="未發車")}),y.value.push({stops:_.StopName.Zh_tw,timeText:u.value,time:s.value})})})},b=o(!0),C=o(!1),L=()=>{C.value=!1,b.value=!0},W=()=>{b.value=!1,C.value=!0};let V,A;const q=()=>{V=setInterval(()=>{I.value--,I.value===0&&(I.value=60)},1e3)},K=()=>{A=setInterval(()=>{H()},6e4)},P=()=>{clearInterval(V),clearInterval(A),q(),K()},Q=()=>{H(),P()},w=x=>ae().path===x;return ee(()=>p.value,()=>{p.value&&setTimeout(()=>{M()},1e3)}),(x,n)=>{const a=te("router-link");return l(),i(S,null,[t("div",pe,[t("nav",_e,[d(a,{to:{name:"Home"}},{default:f(()=>[me]),_:1}),t("div",he,[d(a,{to:"/view/Home.vue",class:"header-link spot text-nowrap",href:"#"},{default:f(()=>[fe,m(" 台灣景點 ")]),_:1}),d(a,{to:"/view/FoodTravel.vue",class:"header-link food text-nowrap",href:"#"},{default:f(()=>[ge,m(" 美食住宿 ")]),_:1}),d(a,{to:{name:"BusRoute"},href:"#",class:"header-link traffic text-nowrap"},{default:f(()=>[we,m(" 景點交通 ")]),_:1})])]),t("ul",ke,[t("li",Se,[d(a,{to:"/view/Home.vue",class:k(["nav-link p-2",{activeTrue:w("/view/Home.vue"),activeFalse:!w("/view/Home.vue")}]),"aria-current":"page"},{default:f(()=>[m("景點活動 ")]),_:1},8,["class"])]),t("li",Te,[d(a,{to:"/view/FoodTravel.vue",class:k(["nav-link p-2",{activeTrue:w("/view/FoodTravel.vue"),activeFalse:!w("/view/FoodTravel.vue")}])},{default:f(()=>[m("美食住宿 ")]),_:1},8,["class"])]),t("li",De,[d(a,{to:"/view/BusRoute/BusRoute.vue",class:k(["nav-link p-2",{activeTrue:w("/view/BusRoute/BusRoute.vue"),activeFalse:!w("/view/BusRoute/BusRoute.vue")}])},{default:f(()=>[m("景點交通 ")]),_:1},8,["class"])])]),t("div",ye,[J(t("select",{name:"",id:"",class:"form-select me-1 rounded border-0 shadow-sm","onUpdate:modelValue":n[0]||(n[0]=e=>p.value=e)},[xe,(l(!0),i(S,null,B(se(oe),(e,r)=>(l(),i("option",{value:e.Value,key:r},c(e.CityName),9,Be))),128))],512),[[z,p.value]]),J(t("select",{name:"",id:"",class:"form-select rounded border-0 shadow-sm","onUpdate:modelValue":n[1]||(n[1]=e=>T.value=e)},[Re,(l(!0),i(S,null,B($.value,e=>(l(),i("option",{value:e.RouteName.Zh_tw,key:e.RouteUID}," ["+c(e.RouteName.Zh_tw)+"] "+c(e.DepartureStopNameZh)+" - "+c(e.DestinationStopNameZh),9,Ie))),128))],512),[[z,T.value]]),t("button",Ne,[t("span",null,[t("i",{class:"bi bi-search",onClick:E(Q,["prevent"])},null,8,be)])])]),t("div",Ce,[Ee,(l(!0),i(S,null,B(j.value,e=>(l(),i("ul",{class:"row row-cols-2 mx-1 rounded py-2 shadow-sm",key:e.RouteID},[t("li",{class:"col",onClick:E(L,["prevent"])},[m("往 "),t("span",Fe,c(e.DepartureStopNameZh),1)],8,Ue),t("li",{class:"col",onClick:E(W,["prevent"])},[m("往 "),t("span",Oe,c(e.DestinationStopNameZh),1)],8,$e)]))),128))])]),t("div",Ze,[t("div",je,[t("p",He," *每隔"+c(I.value)+"秒自動更新",1)])]),t("div",{class:k(["container",D.value.length>0||y.value.length>0?"height":"vhHeight"])},[D.value.length>0||y.value.length>0?(l(),i("div",Ve,[b.value?(l(!0),i(S,{key:0},B(D.value,(e,r)=>(l(),i("div",{key:r,class:"row align-items-center justify-content-md-center gx-0"},[t("p",{class:k(["col-4 col-md-2 rounded p-2 text-center",{arriving:e.time===0,coming:e.time<=1&&e.time>0,onTheWay:e.time>1,noDepart:!e.time}])},c(e.timeText),3),t("p",Ae,c(e.stops),1)]))),128)):U("",!0),C.value?(l(!0),i(S,{key:1},B(y.value,e=>(l(),i("div",Je,[t("p",{class:k(["col-4 col-md-2 rounded p-2 text-center",{arriving:e.time===0,coming:e.time<=1&&e.time>0,onTheWay:e.time>1,noDepart:!e.time}])},c(e.timeText),3),t("p",ze,c(e.stops),1)]))),256)):U("",!0)])):U("",!0)],2),d(ne),d(le)],64)}}},Le=Y(Me,[["__scopeId","data-v-aad8019c"]]);export{Le as default};
